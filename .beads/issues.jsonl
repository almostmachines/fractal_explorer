{"id":"fractal_explorer-10c","title":"Unit tests for RenderScheduler","description":"# Unit tests for RenderScheduler\n\n## What\nTest the render submission gating and coalescing behavior.\n\n## File\nsrc/controllers/interactive/flight/scheduler.rs (#[cfg(test)] mod tests)\n\n## Test cases\n\n### Immediate submission\n1. **Nothing in-flight** → submit immediately, SchedulerAction::Submitted\n2. **In-flight but flight inactive** → submit immediately (cancel), SchedulerAction::Submitted\n\n### Coalescing during flight\n3. **In-flight + flight active** → store as pending, SchedulerAction::Coalesced\n4. **Multiple coalesced** → only newest pending retained (old discarded)\n5. **Pending submitted after completion** → when last_completed_gen >= in_flight_gen, pending is submitted\n\n### Completion detection\n6. **Completion clears in-flight** → after completion, next update submits immediately\n7. **Partial completion (generation mismatch)** → in-flight not cleared until matching generation completes\n\n### Reset\n8. **reset() clears all state** → pending and in_flight both None\n\n### Edge cases\n9. **No desired change** → works correctly with repeated identical requests\n10. **Rapid updates during flight** → only the last one survives coalescing\n\n## Testing approach\nUse a mock submit function that captures the submitted request and returns a predictable generation. Verify that submit is called the expected number of times and with the expected request.\n\n## Acceptance criteria\n- All tests pass\n- Tests verify the exact number of submit calls (no extra cancellations)\n- Tests cover all three cases: immediate, immediate-cancel, coalesce","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T13:49:54.757249332Z","created_by":"ren","updated_at":"2026-03-01T16:31:26.123907861Z","closed_at":"2026-03-01T16:31:26.111704031Z","close_reason":"Added RenderScheduler tests for immediate submit, coalescing, completion gating, reset, and rapid update behavior","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-10c","depends_on_id":"fractal_explorer-2wi","type":"blocks","created_at":"2026-03-01T14:01:31.413408564Z","created_by":"ren"}]}
{"id":"fractal_explorer-15a","title":"[Milestone] Fractal-specific flight updaters","description":"# Milestone: Fractal-specific flight updaters\n\n## Purpose\nImplement algorithm-owned flight update steps that mutate fractal view state from `MotionState` while preserving future divergence between Mandelbrot and Julia.\n\n## Scope\n- `src/core/fractals/mandelbrot/flight.rs`\n- `src/core/fractals/julia/flight.rs`\n- Shared contract shape and report semantics (`FlightUpdateReport`, warnings, clamp signaling).\n- Unit tests for translation, clamping, non-finite reset, and parity between both algorithms.\n\n## Design intent\nBoth algorithms start with equivalent translation and clamp behavior, but implementations remain separate by design. This keeps extension paths open for future algorithm-specific flight rules.\n\n## Definition of done\n- Mandelbrot and Julia flight updaters both compile and are wired in their modules.\n- Translation uses view-relative world units (`extent * speed * dt`).\n- Soft safety clamps are applied and reported.\n- Updater tests pass for both algorithms.\n\n## Acceptance Criteria\n- Child implementation and test tasks are completed.\n- Clamp and non-finite behavior is deterministic and non-fatal.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-03-01T14:11:14.894613189Z","created_by":"ren","updated_at":"2026-03-01T16:25:21.779274368Z","closed_at":"2026-03-01T16:25:21.769476190Z","close_reason":"Completed Mandelbrot and Julia flight updater modules with deterministic clamp and non-finite behavior plus tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-15a","depends_on_id":"fractal_explorer-1xl","type":"blocks","created_at":"2026-03-01T14:15:06.987914934Z","created_by":"ren"},{"issue_id":"fractal_explorer-15a","depends_on_id":"fractal_explorer-2ly","type":"blocks","created_at":"2026-03-01T14:14:32.430750243Z","created_by":"ren"},{"issue_id":"fractal_explorer-15a","depends_on_id":"fractal_explorer-33i","type":"blocks","created_at":"2026-03-01T14:14:31.806990219Z","created_by":"ren"},{"issue_id":"fractal_explorer-15a","depends_on_id":"fractal_explorer-9bc","type":"blocks","created_at":"2026-03-01T14:14:32.111342063Z","created_by":"ren"}],"comments":[{"id":5,"issue_id":"fractal_explorer-15a","author":"John King","text":"This milestone starts after core contracts () and runs  and  in parallel, then converges in  parity/behavior tests. Keep Mandelbrot and Julia updater implementations intentionally separate even if logic matches today.","created_at":"2026-03-01T14:17:13Z"},{"id":10,"issue_id":"fractal_explorer-15a","author":"John King","text":"Superseding note (corrected formatting): this milestone starts after 1xl and runs 33i + 9bc in parallel, then converges into 2ly test coverage.\nImplementations stay separate intentionally for future algorithm divergence.","created_at":"2026-03-01T14:17:25Z"},{"id":20,"issue_id":"fractal_explorer-15a","author":"John King","text":"Note: if an earlier comment in this thread shows missing issue IDs, treat it as a formatting artifact; use the most recent 'Superseding note' comment as authoritative.","created_at":"2026-03-01T14:19:42Z"}]}
{"id":"fractal_explorer-1f0","title":"Implement FlightInputState (GUI key adapter)","description":"# Implement FlightInputState (GUI key adapter)\n\n## What\nGUI-only adapter that tracks held keyboard state for flight controls and produces FlightControlsSnapshot per simulation tick.\n\n## File\nsrc/input/gui/app/flight_input.rs (new file, feature-gated behind \\`gui\\`)\n\n## Also modify\n- src/input/gui/app/mod.rs — add \\`pub mod flight_input;\\`\n\n## Type definition\n\\`\\`\\`rust\npub struct FlightInputState {\n    w_held: bool,\n    a_held: bool,\n    s_held: bool,\n    d_held: bool,\n    j_held: bool,\n    k_held: bool,\n    p_edge_pending: bool,  // set on key-down, cleared after first snapshot\n}\n\\`\\`\\`\n\n## Methods\n\n### handle_key_event(&mut self, key_code: KeyCode, state: ElementState)\nUpdate held state from winit KeyboardInput events:\n- On Press: set the corresponding held flag to true. For P, set p_edge_pending = true.\n- On Release: set the corresponding held flag to false. P release does NOT clear p_edge_pending.\n\n### snapshot(&mut self, text_editing: bool) -> FlightControlsSnapshot\nProduce a snapshot for one simulation tick:\n- If text_editing: return FlightControlsSnapshot::default() (all false). Do NOT consume p_edge_pending (leave it for when text editing ends). Actually — reconsider: the plan says return empty and don't emit pause edge. So clear p_edge_pending too if text_editing, to avoid a stale edge firing when focus returns.\n- Else: build snapshot from held states + p_edge_pending, then clear p_edge_pending.\n\nThe clearing of p_edge_pending is critical: it ensures a single P press produces exactly one toggle even if multiple simulation ticks run in the same frame. The first tick's snapshot gets pause_toggle_edge=true; subsequent ticks get false.\n\n### reset(&mut self)\nClear all state (called on fractal switch or when flight should be reset).\n\n## Key design decisions\n\n### Why &mut self on snapshot()?\nBecause it clears p_edge_pending. The snapshot is a \"consuming\" operation for edge-triggered inputs. This is intentional — it prevents a single keypress from toggling pause multiple times across ticks.\n\n### Why not use winit's keyboard API directly in the simulator?\nThe simulator lives in controllers/ and must be GUI-free. FlightInputState bridges the gap: it speaks winit on one side and FlightControlsSnapshot on the other. This follows the hexagonal architecture's input adapter pattern.\n\n### Focus suppression via text_editing parameter\nRather than having FlightInputState know about egui internals, the caller passes a boolean. Currently this will be egui_ctx.wants_keyboard_input(), but it could be any predicate. This keeps the adapter testable without egui.\n\n### What about key repeat events?\nwinit may send repeat events for held keys. These should be ignored for held state (already true) and for P edge (already pending). The handle_key_event method naturally handles this: setting true to true is a no-op, and p_edge_pending stays true until consumed.\n\n## Acceptance criteria\n- Tracks W/A/S/D/J/K held state correctly\n- P edge fires exactly once per keypress\n- Focus suppression returns empty snapshot\n- p_edge_pending is consumed on first snapshot() call\n- Feature-gated behind \\`gui\\`\n- No dependencies on egui (receives bool, not Context)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-03-01T13:50:26.565050066Z","created_by":"ren","updated_at":"2026-03-01T16:32:58.964218268Z","closed_at":"2026-03-01T16:32:58.952533278Z","close_reason":"Implemented GUI FlightInputState adapter with held-key and one-shot pause-edge semantics","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-1f0","depends_on_id":"fractal_explorer-1sm","type":"blocks","created_at":"2026-03-01T14:01:31.535508613Z","created_by":"ren"},{"issue_id":"fractal_explorer-1f0","depends_on_id":"fractal_explorer-30g","type":"blocks","created_at":"2026-03-01T14:15:22.185964920Z","created_by":"ren"}],"comments":[{"id":17,"issue_id":"fractal_explorer-1f0","author":"John King","text":"Focus-suppression behavior for snapshot() must follow policy finalized in 30g to avoid stale-edge surprises.","created_at":"2026-03-01T14:18:14Z"}]}
{"id":"fractal_explorer-1kk","title":"[Milestone] Verification, tuning, and acceptance","description":"# Milestone: Verification, tuning, and acceptance\n\n## Purpose\nEnsure the full flight system is validated with automated tests and scenario-driven manual checks, and lock initial tuning values/policies for reproducible behavior.\n\n## Scope\n- Resolve open tuning and policy decisions from the architecture plan.\n- Ensure all required unit test suites are completed before manual validation.\n- Execute manual acceptance scenarios covering controls, switching, clamps, starvation prevention, and focus suppression.\n\n## Why this milestone exists\nImplementation alone is insufficient for this feature: we need confidence that behavior is deterministic, robust, and aligned with the intended user experience.\n\n## Definition of done\n- All test-oriented child issues are completed.\n- Manual acceptance scenarios are executed and documented.\n- Final tuning/policy choices are captured in beads comments/issue history.\n\n## Acceptance Criteria\n- Child tasks are completed and closed.\n- Flight feature epic can be closed without consulting external planning docs.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-03-01T14:11:15.344810015Z","created_by":"ren","updated_at":"2026-03-01T17:19:01.958237762Z","closed_at":"2026-03-01T17:19:01.944535573Z","close_reason":"Verification milestone complete: all automated flight test suites passing and manual acceptance task 364 closed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-1kk","depends_on_id":"fractal_explorer-15a","type":"blocks","created_at":"2026-03-01T14:15:09.173379619Z","created_by":"ren"},{"issue_id":"fractal_explorer-1kk","depends_on_id":"fractal_explorer-1xl","type":"blocks","created_at":"2026-03-01T14:15:08.803591239Z","created_by":"ren"},{"issue_id":"fractal_explorer-1kk","depends_on_id":"fractal_explorer-364","type":"blocks","created_at":"2026-03-01T14:14:36.103628633Z","created_by":"ren"},{"issue_id":"fractal_explorer-1kk","depends_on_id":"fractal_explorer-3ck","type":"blocks","created_at":"2026-03-01T14:15:09.558416968Z","created_by":"ren"},{"issue_id":"fractal_explorer-1kk","depends_on_id":"fractal_explorer-3nv","type":"blocks","created_at":"2026-03-01T14:15:09.949502747Z","created_by":"ren"}],"comments":[{"id":8,"issue_id":"fractal_explorer-1kk","author":"John King","text":"Verification milestone policy: manual acceptance  is blocked on all automated test suites plus decision-lock issue . This prevents scenario testing against partially validated behavior.","created_at":"2026-03-01T14:17:14Z"},{"id":13,"issue_id":"fractal_explorer-1kk","author":"John King","text":"Superseding note (corrected formatting): 364 manual acceptance is intentionally gated on automated tests and 30g decision lock.\nThis enforces verify-first workflow and keeps acceptance runs meaningful.","created_at":"2026-03-01T14:17:26Z"},{"id":23,"issue_id":"fractal_explorer-1kk","author":"John King","text":"Note: if an earlier comment in this thread shows missing issue IDs, treat it as a formatting artifact; use the most recent 'Superseding note' comment as authoritative.","created_at":"2026-03-01T14:19:43Z"}]}
{"id":"fractal_explorer-1sm","title":"Implement FlightControlsSnapshot","description":"# Implement FlightControlsSnapshot\n\n## What\nDefine the per-tick input snapshot struct that captures keyboard state for one simulation tick.\n\n## File\nsrc/core/flight/controls.rs\n\n## Type definition\n\\`\\`\\`rust\n#[derive(Debug, Clone, Copy, PartialEq, Default)]\npub struct FlightControlsSnapshot {\n    pub w: bool,        // screen-up\n    pub a: bool,        // screen-left\n    pub s: bool,        // screen-down\n    pub d: bool,        // screen-right\n    pub accelerate: bool,     // K held\n    pub decelerate: bool,     // J held\n    pub pause_toggle_edge: bool, // P down-edge (true for exactly one tick)\n}\n\\`\\`\\`\n\n## Key design decisions\n\n### Why a snapshot struct instead of individual parameters?\nBundling all input state into a single struct makes the motion step function signature clean and extensible. Adding new controls (e.g., zoom keys) later only requires adding fields, not changing function signatures throughout the call chain.\n\n### Why pause_toggle_edge instead of pause_held?\nPause is edge-triggered (toggle on press), not level-triggered (hold to pause). The snapshot captures whether a P key-down event occurred during this tick. The GUI adapter is responsible for consuming the edge so it fires exactly once per press, even if multiple simulation ticks run within a single frame.\n\n### Focus suppression strategy\nWhen a text-edit widget has focus (e.g., egui text input), the GUI adapter returns FlightControlsSnapshot::default() (all false). This means flight hotkeys have no effect while typing. The suppression happens at the adapter boundary, keeping this struct unaware of GUI concerns.\n\n## Acceptance criteria\n- Struct defined with all fields\n- Default derives to all-false (no keys pressed)\n- Debug, Clone, Copy, PartialEq derived\n- No GUI dependencies\n- Unit test verifying default is all-false","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T13:46:04.511399702Z","created_by":"ren","updated_at":"2026-03-01T16:18:43.061076518Z","closed_at":"2026-03-01T16:18:43.053994914Z","close_reason":"Implemented FlightControlsSnapshot with default behavior test","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-1sm","depends_on_id":"fractal_explorer-24b","type":"related","created_at":"2026-03-01T14:17:46.892048161Z","created_by":"ren"}],"comments":[{"id":24,"issue_id":"fractal_explorer-1sm","author":"John King","text":"Sequencing note: 24b is linked as a related dependency (not blocks) due dependency-cycle constraints in br for this graph shape. Treat 24b as the preferred scaffold-first order in practice.","created_at":"2026-03-01T14:19:48Z"}]}
{"id":"fractal_explorer-1tg","title":"Add flight status to debug panel UI","description":"# Add flight status to debug panel UI\n\n## What\nAdd a minimal \"Flight\" section to the existing egui debug panel showing current flight state.\n\n## File to modify\nsrc/input/gui/app/gui_app.rs (in update_ui() method)\n\n## UI elements to add\nIn the existing debug panel (egui::SidePanel or Window), add a \"Flight\" section:\n- **Status**: \"Paused\" / \"Active\" / \"Idle\" (idle = not paused but speed=0)\n- **Speed**: signed f64, formatted to 2 decimal places (e.g., \"1.50 u/s\")\n- **Heading**: (x, y) formatted to 2 decimal places (e.g., \"(0.71, -0.71)\")\n- **Warning**: last flight warning if any, or empty (e.g., \"Speed clamped\")\n\nOptional (nice-to-have, implement if trivial):\n- Scheduler info: in-flight generation, pending flag\n\n## Design rationale\nThe spec says \"no UI redesign beyond key behavior and visible status.\" This is the minimal status display needed for users to understand what's happening during flight and for developers to debug issues.\n\nThe status reads from flight_sim.status(), which is a pure read — no mutation.\n\n## Acceptance criteria\n- Flight section visible in debug panel\n- Shows paused/active/idle status\n- Shows speed and heading\n- Shows last warning (if any)\n- Does not interfere with existing debug panel layout\n- Minimal code addition (reuse egui patterns from existing panel)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-03-01T13:51:13.241351944Z","created_by":"ren","updated_at":"2026-03-01T16:36:05.038883874Z","closed_at":"2026-03-01T16:36:05.025046880Z","close_reason":"Added Flight status panel (paused/active/idle, speed, heading, warnings, scheduler state) to debug UI","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-1tg","depends_on_id":"fractal_explorer-oeb","type":"blocks","created_at":"2026-03-01T14:01:32.294560709Z","created_by":"ren"}]}
{"id":"fractal_explorer-1xl","title":"[Milestone] Core flight domain foundation","description":"# Milestone: Core flight domain foundation\n\n## Purpose\nImplement the GUI-independent flight domain contract so all later simulation, scheduling, and GUI work can depend on stable primitives.\n\n## Scope\n- `core::flight` module structure and exports.\n- `FlightControlsSnapshot` input contract.\n- `FlightLimits` tuning and clamp constants.\n- `FlightStatus`/`FlightWarning` UI-safe status surface.\n- `MotionState` + deterministic `step_motion()` semantics.\n- Core-domain unit tests that validate defaults and invariants.\n\n## Why this milestone exists\nThis milestone turns the behavioral spec into executable core contracts while keeping `src/core/**` free of GUI dependencies. It is the architectural boundary that allows controllers and GUI adapters to evolve without touching domain logic.\n\n## Definition of done\n- All core flight primitives exist and compile in non-GUI builds.\n- Motion semantics match the spec exactly (heading persistence, signed speed, pause edge handling, speed clamping).\n- Core primitive tests and motion tests pass.\n- No core module imports `winit`, `egui`, or GUI-only types.\n\n## Acceptance Criteria\n- Child issues under this milestone are completed and closed.\n- No unresolved open decision remains that affects core motion semantics.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-03-01T14:11:14.747771400Z","created_by":"ren","updated_at":"2026-03-01T16:19:34.673921925Z","closed_at":"2026-03-01T16:19:34.663694475Z","close_reason":"Completed core::flight primitives, motion semantics, and core unit tests in non-GUI core layer","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-1xl","depends_on_id":"fractal_explorer-1sm","type":"blocks","created_at":"2026-03-01T14:14:29.770295020Z","created_by":"ren"},{"issue_id":"fractal_explorer-1xl","depends_on_id":"fractal_explorer-1ya","type":"blocks","created_at":"2026-03-01T14:14:30.621115865Z","created_by":"ren"},{"issue_id":"fractal_explorer-1xl","depends_on_id":"fractal_explorer-24b","type":"blocks","created_at":"2026-03-01T14:14:03.616218135Z","created_by":"ren"},{"issue_id":"fractal_explorer-1xl","depends_on_id":"fractal_explorer-28c","type":"blocks","created_at":"2026-03-01T14:14:30.912721604Z","created_by":"ren"},{"issue_id":"fractal_explorer-1xl","depends_on_id":"fractal_explorer-2bx","type":"blocks","created_at":"2026-03-01T14:14:31.209171785Z","created_by":"ren"},{"issue_id":"fractal_explorer-1xl","depends_on_id":"fractal_explorer-30g","type":"blocks","created_at":"2026-03-01T14:14:31.504236627Z","created_by":"ren"},{"issue_id":"fractal_explorer-1xl","depends_on_id":"fractal_explorer-323","type":"blocks","created_at":"2026-03-01T14:14:30.338309870Z","created_by":"ren"},{"issue_id":"fractal_explorer-1xl","depends_on_id":"fractal_explorer-ejp","type":"blocks","created_at":"2026-03-01T14:14:30.046884601Z","created_by":"ren"}],"comments":[{"id":4,"issue_id":"fractal_explorer-1xl","author":"John King","text":"Execution order inside this milestone:  scaffolding +  decision lock -> (, , ) primitives ->  motion step -> validation tasks (, ). The milestone closes only when both implementation and primitive-level tests are complete.","created_at":"2026-03-01T14:17:12Z"},{"id":9,"issue_id":"fractal_explorer-1xl","author":"John King","text":"Superseding note (corrected formatting): execution order for this milestone is\n24b + 30g -> (1sm, ejp, 323) -> 1ya -> (28c, 2bx).\nThis keeps decisions and primitive contracts stable before motion implementation and tests.","created_at":"2026-03-01T14:17:24Z"},{"id":19,"issue_id":"fractal_explorer-1xl","author":"John King","text":"Note: if an earlier comment in this thread shows missing issue IDs, treat it as a formatting artifact; use the most recent 'Superseding note' comment as authoritative.","created_at":"2026-03-01T14:19:41Z"}]}
{"id":"fractal_explorer-1ya","title":"Implement MotionState and step_motion()","description":"# Implement MotionState and step_motion()\n\n## What\nThe heart of the flight system: the motion state struct and the pure, deterministic per-tick step function.\n\n## File\nsrc/core/flight/motion.rs\n\n## Type definition\n\\`\\`\\`rust\n#[derive(Debug, Clone, Copy, PartialEq)]\npub struct MotionState {\n    pub paused: bool,\n    pub heading: [f64; 2],\n    pub speed_world_per_sec: f64,\n    pub accel_world_per_sec2: f64,\n}\n\\`\\`\\`\n\nDefaults: paused=false, heading=[0.0, -1.0] (screen-up), speed=0.0, accel=0.0.\n\n## Core function\n\\`\\`\\`rust\npub fn step_motion(\n    motion: &mut MotionState,\n    controls: FlightControlsSnapshot,\n    dt: f64,\n    limits: &FlightLimits,\n) -> MotionStepReport\n\\`\\`\\`\n\n### Per-tick algorithm (order matters!)\n1. **Pause toggle**: If controls.pause_toggle_edge, flip motion.paused.\n2. **Early return if paused**: No heading/speed changes while paused.\n3. **Resolve heading from WASD**:\n   - Combine direction vectors: W=(0,-1), S=(0,1), A=(-1,0), D=(1,0)\n   - If combined magnitude > 0: normalize and store as new heading\n   - If no WASD held: retain existing heading (heading persistence)\n4. **Compute effective acceleration**:\n   - +base_accel if accelerate (K), -base_accel if decelerate (J)\n   - Both held: sum (cancels to 0)\n   - Neither: 0\n   - Store in motion.accel_world_per_sec2 for status display\n5. **Integrate speed**: speed += accel * dt\n6. **Clamp speed**: clamp to [-max_speed_abs, +max_speed_abs], emit warning if clamped\n\n### MotionStepReport\nA small return value indicating what happened:\n- pause_toggled: bool\n- speed_clamped: bool\n- view_should_update: bool (true if not paused and speed != 0)\n\n## Key design decisions\n\n### Why is step_motion a free function, not a method on MotionState?\nEither works, but a free function with explicit parameters makes the dependency on FlightLimits and FlightControlsSnapshot visible at the call site. It also makes testing straightforward — no need to construct a \"self\" with extra state.\n\n### Why signed speed + unsigned heading instead of a velocity vector?\nThe spec requires J/K to modulate speed magnitude with natural reversal through zero. A signed scalar + unit heading cleanly models this: J reduces speed, and when speed crosses zero, movement reverses direction without the heading flipping. A velocity vector would require additional logic to handle the reversal semantics.\n\n### Why heading=[0,-1] as default?\nScreen-up. In screen coordinates, Y increases downward, so \"up\" is negative Y. This matches the spec's \"default heading: screen-up (W direction)\".\n\n### Diagonal normalization\nW+D gives (1,-1), normalized to (0.707, -0.707). This ensures diagonal movement isn't faster than cardinal movement — a classic game input normalization pattern.\n\n## Acceptance criteria\n- MotionState struct with Default\n- step_motion() implements the 6-step algorithm exactly\n- MotionStepReport returned with relevant flags\n- Comprehensive unit tests (see dedicated testing task)\n- Pure function: no side effects, no IO, no allocations","status":"closed","priority":1,"issue_type":"task","created_at":"2026-03-01T13:47:12.864053575Z","created_by":"ren","updated_at":"2026-03-01T16:19:02.387573397Z","closed_at":"2026-03-01T16:19:02.376739094Z","close_reason":"Implemented MotionState, deterministic step_motion, and motion step reporting","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-1ya","depends_on_id":"fractal_explorer-1sm","type":"blocks","created_at":"2026-03-01T13:59:29.886854876Z","created_by":"ren"},{"issue_id":"fractal_explorer-1ya","depends_on_id":"fractal_explorer-323","type":"blocks","created_at":"2026-03-01T13:59:30.067069115Z","created_by":"ren"},{"issue_id":"fractal_explorer-1ya","depends_on_id":"fractal_explorer-ejp","type":"blocks","created_at":"2026-03-01T13:59:29.971346761Z","created_by":"ren"}]}
{"id":"fractal_explorer-24b","title":"Create core::flight module skeleton","description":"# Create core::flight module skeleton\n\n## What\nCreate the module structure for `src/core/flight/` with empty mod.rs wiring.\n\n## Files to create\n- src/core/flight/mod.rs — re-exports for controls, motion, limits, status\n- src/core/flight/controls.rs — (empty, placeholder)\n- src/core/flight/motion.rs — (empty, placeholder)\n- src/core/flight/limits.rs — (empty, placeholder)\n- src/core/flight/status.rs — (empty, placeholder)\n\n## Files to modify\n- src/core/mod.rs — add \\`pub mod flight;\\`\n\n## Design rationale\nAll flight domain logic lives under core/ so it remains free of GUI/IO dependencies. This follows the hexagonal architecture pattern used throughout the codebase. The module split mirrors the plan's separation of concerns: controls (input snapshot), motion (physics step), limits (tuning/clamps), status (UI-friendly feedback).\n\n## Acceptance criteria\n- \\`cargo build\\` succeeds with the new empty modules\n- No feature gates needed — core flight types are GUI-free\n- Module hierarchy matches the plan layout\n\n## Context\nThis is the foundational scaffolding. All subsequent core flight work depends on these modules existing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T13:45:49.353707264Z","created_by":"ren","updated_at":"2026-03-01T16:18:42.501452498Z","closed_at":"2026-03-01T16:18:42.491812125Z","close_reason":"Added core::flight module skeleton and wired core::mod","source_repo":".","compaction_level":0,"original_size":0}
{"id":"fractal_explorer-28c","title":"Unit tests for step_motion()","description":"# Unit tests for step_motion()\n\n## What\nComprehensive unit tests for the motion step function covering all behavioral scenarios from the spec.\n\n## File\nsrc/core/flight/motion.rs (inline #[cfg(test)] mod tests)\n\n## Test cases\n\n### Heading resolution\n1. **W only** → heading = (0, -1) (screen-up)\n2. **S only** → heading = (0, 1) (screen-down)\n3. **A only** → heading = (-1, 0) (screen-left)\n4. **D only** → heading = (1, 0) (screen-right)\n5. **W+D diagonal** → heading ≈ (0.707, -0.707), verify unit length\n6. **W+A diagonal** → heading ≈ (-0.707, -0.707)\n7. **All four WASD** → zero vector, heading unchanged (vectors cancel)\n8. **No WASD** → heading retained from previous state (heading persistence)\n\n### Speed integration\n9. **K held, no movement** → speed increases by base_accel * dt\n10. **J held** → speed decreases by base_accel * dt\n11. **K+J both held** → accel cancels to 0, speed unchanged\n12. **Neither J nor K** → accel = 0, speed unchanged\n13. **Speed reversal through zero** → J while moving forward: speed goes positive → 0 → negative naturally\n14. **Speed clamp at max** → K held continuously, speed caps at max_speed_abs\n15. **Speed clamp at -max** → J held continuously, speed caps at -max_speed_abs\n\n### Pause semantics\n16. **P edge toggles pause** → paused flips from false to true\n17. **P edge while paused** → paused flips from true to false\n18. **Paused prevents motion** → while paused, heading and speed unchanged even with WASD/JK held\n19. **Pause edge consumed once** → pause_toggle_edge in controls fires exactly one toggle per tick\n20. **Resume preserves state** → after unpause, speed and heading are exactly what they were before pause\n\n### Edge cases\n21. **Zero dt** → no speed change regardless of acceleration\n22. **Default motion state** → paused=false, heading=(0,-1), speed=0, accel=0\n23. **Report flags** → verify MotionStepReport has correct flags for each scenario\n\n## Testing strategy\n- All tests are deterministic (no randomness, no timing)\n- Use exact f64 comparisons where possible, epsilon for normalized vectors\n- Each test covers one behavioral requirement from the spec\n- Tests are documentation: each test name maps to a spec requirement\n\n## Acceptance criteria\n- All 23+ test cases pass\n- Tests run fast (< 1 second total)\n- No flaky tests (deterministic inputs → deterministic outputs)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T13:47:32.936682710Z","created_by":"ren","updated_at":"2026-03-01T16:19:23.490795361Z","closed_at":"2026-03-01T16:19:23.480109491Z","close_reason":"Added comprehensive deterministic step_motion unit tests for heading, speed, pause, clamp, and report semantics","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-28c","depends_on_id":"fractal_explorer-1ya","type":"blocks","created_at":"2026-03-01T14:01:30.463460754Z","created_by":"ren"}]}
{"id":"fractal_explorer-2bx","title":"Unit tests for core flight primitives","description":"# Unit tests for core flight primitives\n\n## What\nAdd deterministic unit tests for foundational types in `src/core/flight` that are not fully covered by `step_motion()` tests.\n\n## Files\n- `src/core/flight/controls.rs`\n- `src/core/flight/limits.rs`\n- `src/core/flight/status.rs`\n\n## Test coverage\n1. `FlightControlsSnapshot::default()` is all-false and semantically neutral.\n2. `FlightLimits::default()` values are finite, sane, and internally consistent (`tick_hz > 0`, `min_extent <= max_extent`, etc.).\n3. `FlightLimits::dt()` returns a stable positive value based on `tick_hz`.\n4. `MotionState::default()` and `FlightStatus::default()` alignment assumptions remain true.\n5. Warning/status carry-through semantics for simple status update paths.\n\n## Why this matters\nThese primitives are relied upon by every higher layer. Tight tests here catch regressions early and keep downstream debugging simple.\n\n## Acceptance criteria\n- Tests are colocated with modules under `#[cfg(test)]`.\n- All tests are deterministic and fast.\n- Coverage includes defaults, invariants, and helper behavior.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T14:11:15.517645893Z","created_by":"ren","updated_at":"2026-03-01T16:19:24.728374933Z","closed_at":"2026-03-01T16:19:24.717075771Z","close_reason":"Added primitive tests for controls, limits, status defaults and alignment invariants","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-2bx","depends_on_id":"fractal_explorer-1sm","type":"blocks","created_at":"2026-03-01T14:15:22.985023801Z","created_by":"ren"},{"issue_id":"fractal_explorer-2bx","depends_on_id":"fractal_explorer-1ya","type":"blocks","created_at":"2026-03-01T14:15:24.226757603Z","created_by":"ren"},{"issue_id":"fractal_explorer-2bx","depends_on_id":"fractal_explorer-323","type":"blocks","created_at":"2026-03-01T14:15:23.806093737Z","created_by":"ren"},{"issue_id":"fractal_explorer-2bx","depends_on_id":"fractal_explorer-ejp","type":"blocks","created_at":"2026-03-01T14:15:23.392112757Z","created_by":"ren"}]}
{"id":"fractal_explorer-2ly","title":"Unit tests for fractal flight updaters","description":"# Unit tests for fractal flight updaters\n\n## What\nTest both Mandelbrot and Julia flight update functions. Since the logic is currently identical, both should have parallel test suites.\n\n## Files\n- src/core/fractals/mandelbrot/flight.rs (#[cfg(test)] mod tests)\n- src/core/fractals/julia/flight.rs (#[cfg(test)] mod tests)\n\n## Test cases (for each fractal)\n\n### Translation\n1. **Forward at speed 1.0** → region translates by heading * dt * extent\n2. **Reverse (negative speed)** → region translates in opposite direction\n3. **Diagonal heading** → both real and imag components translate\n4. **Zero speed** → no translation (early return)\n5. **Paused** → no translation (early return)\n\n### View-relative scaling\n6. **Same speed, different zoom** → delta is proportional to region extent (larger region = larger absolute delta for same speed)\n7. **Non-square region** → delta_real uses width(), delta_imag uses height()\n\n### Center clamp\n8. **Center within bounds** → no clamp, no warning\n9. **Center exceeds max_center_abs on real axis** → clamped, width/height preserved\n10. **Center exceeds max_center_abs on imag axis** → clamped, width/height preserved\n11. **Center exceeds on both axes** → both clamped\n\n### Extent clamp\n12. **Extents within bounds** → no clamp\n13. **Width below min** → scaled up, aspect ratio preserved\n14. **Width above max** → scaled down, aspect ratio preserved\n\n### Non-finite guard\n15. **NaN in region** → reset to default, NonFiniteReset warning\n16. **Infinity in region** → reset to default, NonFiniteReset warning\n\n### FlightUpdateReport\n17. **No clamp** → clamped=false, warning=None\n18. **Clamp triggered** → clamped=true, warning=Some(...)\n\n## Acceptance criteria\n- All tests pass for both Mandelbrot and Julia\n- Tests verify region dimensions are preserved through clamping\n- Tests verify aspect ratio preservation in extent clamping\n- Each test is self-documenting with descriptive names","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T13:48:18.557619242Z","created_by":"ren","updated_at":"2026-03-01T16:25:14.645705585Z","closed_at":"2026-03-01T16:25:14.634089624Z","close_reason":"Added deterministic updater tests for translation, scaling, clamping, non-finite reset, and report semantics for both fractals","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-2ly","depends_on_id":"fractal_explorer-33i","type":"blocks","created_at":"2026-03-01T14:01:30.758094792Z","created_by":"ren"},{"issue_id":"fractal_explorer-2ly","depends_on_id":"fractal_explorer-9bc","type":"blocks","created_at":"2026-03-01T14:01:30.859916267Z","created_by":"ren"}]}
{"id":"fractal_explorer-2wi","title":"Implement RenderScheduler","description":"# Implement RenderScheduler\n\n## What\nSubmission gate that coalesces render requests during flight so frames can complete without starvation, while preserving snappy \"latest wins\" behavior when flight is inactive.\n\n## File\nsrc/controllers/interactive/flight/scheduler.rs (new file)\n\n## Type definition\n\\`\\`\\`rust\npub struct RenderScheduler {\n    pending_request: Option<Arc<FractalConfig>>,\n    in_flight_generation: Option<u64>,\n}\n\\`\\`\\`\n\n## Core method\n\\`\\`\\`rust\npub fn update(\n    &mut self,\n    desired: Arc<FractalConfig>,\n    flight_active: bool,\n    last_completed_gen: u64,\n    submit: impl FnOnce(Arc<FractalConfig>) -> u64,  // returns generation\n) -> SchedulerAction\n\\`\\`\\`\n\n### Behavior\n\n#### Case 1: Nothing in-flight\nSubmit immediately. Store returned generation as in_flight_generation.\n\n#### Case 2: In-flight, flight NOT active\nSubmit immediately (cancel the in-flight render). This preserves the current \"snappy\" behavior for occasional UI changes like slider adjustments or fractal switching. User expects instant response when tweaking parameters.\n\n#### Case 3: In-flight, flight IS active\nStore desired as pending_request (replace any previous pending). Do NOT submit yet. Wait until the in-flight generation completes (last_completed_gen >= in_flight_generation), then submit the pending request.\n\n#### Completion detection\nOn each update() call, check if the in-flight generation has completed. If so, clear in_flight_generation. If there's a pending request, submit it.\n\n### SchedulerAction (return value)\n\\`\\`\\`rust\npub enum SchedulerAction {\n    Submitted { generation: u64 },\n    Coalesced,  // stored as pending, no submission\n    NothingToDo,\n}\n\\`\\`\\`\n\n## Why this design?\n\n### The core tension\nFlight generates new desired states at simulation rate (60Hz). Renders take 10-500ms depending on complexity. If we submit every desired state, most renders get cancelled before completing, and the user sees a frozen screen during motion.\n\n### Why not just throttle by time?\nA time-based throttle (e.g., \"submit at most every 100ms\") is simple but unreliable:\n- If renders take longer than the throttle interval, we still cancel too often\n- If renders are fast, we unnecessarily delay submissions\n- The optimal throttle interval depends on scene complexity, which varies\n\n### Why completion-based gating is better\nBy waiting for the in-flight render to actually complete before submitting the next one, we guarantee that at least one frame is presented per submission cycle. This adapts naturally to render duration: fast renders get more submissions, slow renders get fewer — exactly the right behavior.\n\n### Why immediate submit when flight is inactive?\nWhen the user adjusts a slider or switches fractals, they expect instant visual feedback. The \"latest wins\" cancellation model was designed for this. We only need to gate submissions during flight when rapid state changes would cause starvation.\n\n## Additional methods\n- new() -> Self\n- reset(&mut self) — clear pending and in-flight (called on fractal switch)\n- has_pending(&self) -> bool — for UI/debugging\n\n## Acceptance criteria\n- Immediate submission when nothing in-flight\n- Immediate submission when in-flight but flight inactive\n- Coalescing when in-flight and flight active\n- Pending request is always the newest (old pending replaced)\n- Completion detection works (submits pending after in-flight completes)\n- reset() clears state cleanly\n- Comprehensive unit tests","status":"closed","priority":1,"issue_type":"task","created_at":"2026-03-01T13:49:43.699931324Z","created_by":"ren","updated_at":"2026-03-01T16:31:13.110802997Z","closed_at":"2026-03-01T16:31:13.100190824Z","close_reason":"Implemented completion-gated RenderScheduler with pending coalescing, reset, and submission actions","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-2wi","depends_on_id":"fractal_explorer-30g","type":"blocks","created_at":"2026-03-01T14:15:22.585220948Z","created_by":"ren"},{"issue_id":"fractal_explorer-2wi","depends_on_id":"fractal_explorer-3p2","type":"blocks","created_at":"2026-03-01T14:01:31.295534544Z","created_by":"ren"}],"comments":[{"id":18,"issue_id":"fractal_explorer-2wi","author":"John King","text":"Scheduler gating semantics should implement the policy locked in 30g (strict completion gating while flight active, immediate submit when inactive).","created_at":"2026-03-01T14:18:15Z"}]}
{"id":"fractal_explorer-2wo","title":"Implement FlightSimulator fixed-tick driver","description":"# Implement FlightSimulator fixed-tick driver\n\n## What\nThe orchestrator that owns MotionState, drives fixed-tick simulation, and coordinates motion step + fractal-specific update.\n\n## File\nsrc/controllers/interactive/flight/simulator.rs (new file)\n\n## Also create/modify\n- src/controllers/interactive/flight/mod.rs — module wiring\n- src/controllers/interactive/mod.rs — add \\`pub mod flight;\\`\n\n## Type definition\n\\`\\`\\`rust\npub struct FlightSimulator {\n    motion: MotionState,\n    limits: FlightLimits,\n    accumulator_secs: f64,\n    status: FlightStatus,\n}\n\\`\\`\\`\n\n## Core method\n\\`\\`\\`rust\npub fn advance(\n    &mut self,\n    elapsed: Duration,\n    controls_fn: impl Fn() -> FlightControlsSnapshot,\n    update_fractal: impl FnMut(&MotionState, f64, &FlightLimits),\n) -> SimulationResult\n\\`\\`\\`\n\n### Algorithm\n1. Add elapsed.as_secs_f64() to accumulator\n2. Compute dt = 1.0 / limits.tick_hz\n3. Count ticks = min(accumulator / dt, max_ticks_per_redraw)\n4. For each tick:\n   a. Get controls snapshot via controls_fn()\n   b. Call step_motion(&mut self.motion, controls, dt, &self.limits)\n   c. Call update_fractal(&self.motion, dt, &self.limits)\n   d. Update self.status from motion state + any warnings\n5. Subtract consumed time from accumulator\n6. Return SimulationResult { state_changed, ticks_run, status }\n\n### Why controls_fn is a closure called per-tick\nThe pause_toggle_edge must be consumed exactly once. If we sampled controls once and ran multiple ticks, a single P press could toggle pause multiple times. Per-tick sampling via closure lets the GUI adapter clear the edge after the first tick consumes it.\n\n### Why update_fractal is a FnMut closure, not a trait object\nThe simulator doesn't need to know which fractal is active — it delegates via the closure. The caller (GuiApp) dispatches to the correct fractal updater based on selected_fractal. This avoids generic type parameters on FlightSimulator and keeps it fractal-agnostic.\n\n### Spiral-of-death guard\nIf a frame takes 500ms and tick_hz=60, that's 30 ticks. Without a cap, this causes a visible \"catch-up\" jump. max_ticks_per_redraw (e.g., 10) limits this: excess time is silently dropped. The visual effect is that motion slows down during heavy frames rather than jumping forward — much less disorienting.\n\n## Additional methods\n- new(limits: FlightLimits) -> Self\n- reset_motion(&mut self) — reset MotionState to defaults (called on fractal switch)\n- status(&self) -> &FlightStatus — read-only access for UI\n- is_active(&self) -> bool — true if not paused and (speed != 0 or accel keys held)\n\n## Design rationale\n\n### Why does FlightSimulator live in controllers/, not core/?\nIt orchestrates timing and delegates to core functions. It doesn't contain domain logic itself — it's a coordination/timing concern. Core contains pure types and functions; controllers coordinate them with real-world concerns like elapsed time.\n\n### Why not embed MotionState in GuiAppState?\nMotionState is a flight-system concern. GuiAppState holds rendering configuration. Embedding motion in GuiAppState would couple the UI state to flight internals, making it harder to test the simulator independently.\n\n## Acceptance criteria\n- FlightSimulator advances correct number of ticks for given elapsed time\n- Tick cap prevents spiral of death\n- Accumulator handles fractional ticks correctly\n- reset_motion() returns to defaults\n- is_active() is true when motion is occurring\n- status() reflects current motion state\n- No GUI dependencies (this is in controllers/, not input/)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-03-01T13:48:45.980833498Z","created_by":"ren","updated_at":"2026-03-01T16:31:05.890842367Z","closed_at":"2026-03-01T16:31:05.878930464Z","close_reason":"Implemented fixed-tick FlightSimulator with accumulator, cap, reset, status, and activity checks","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-2wo","depends_on_id":"fractal_explorer-1sm","type":"blocks","created_at":"2026-03-01T14:01:31.077680231Z","created_by":"ren"},{"issue_id":"fractal_explorer-2wo","depends_on_id":"fractal_explorer-1ya","type":"blocks","created_at":"2026-03-01T14:01:30.965364839Z","created_by":"ren"}]}
{"id":"fractal_explorer-30g","title":"Lock and document flight tuning decisions","description":"# Lock and document flight tuning decisions\n\n## What\nResolve and record initial values/policies that were intentionally left as open decisions in the architecture plan so implementation is aligned and traceable.\n\n## Decisions to lock\n1. `tick_hz` and `max_ticks_per_redraw` baseline values.\n2. `base_accel_world_per_sec2` and `max_speed_abs_world_per_sec` initial tuning.\n3. `min_region_extent`, `max_region_extent`, and `max_center_abs` safety bounds.\n4. Focus suppression predicate policy (initially `egui_ctx.wants_keyboard_input()` vs narrower text-only predicate).\n5. RenderScheduler gating policy detail (strict completion gating during active flight).\n6. Confirmation of world-unit definition (fraction-of-view per second).\n\n## Deliverable\n- One detailed comment on this issue documenting final chosen values, rationale, tradeoffs, and follow-up tuning hooks.\n- Cross-links to implementation issues that consume these decisions.\n\n## Why this matters\nWithout explicit decision capture, constants and policy choices become implicit tribal knowledge and are hard to revisit safely.\n\n## Acceptance criteria\n- All six decision points are explicitly resolved.\n- Rationale is written for each choice.\n- Downstream implementation tasks reference this issue for source of truth.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-03-01T14:11:16.051920333Z","created_by":"ren","updated_at":"2026-03-01T16:18:37.789099433Z","closed_at":"2026-03-01T16:18:37.779449769Z","close_reason":"Baseline tuning decisions documented in issue comments","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":2,"issue_id":"fractal_explorer-30g","author":"John King","text":"Decision baseline locked for initial implementation (derived from spec + architecture + implementation plans):\n\n1) Tick rate and catch-up policy\n- `tick_hz = 60`\n- `max_ticks_per_redraw = 10`\n- Rationale: deterministic motion with smooth feel; cap avoids spiral-of-death jumps under heavy frames.\n\n2) Motion tuning\n- `base_accel_world_per_sec2 = 0.5`\n- `max_speed_abs_world_per_sec = 5.0`\n- Rationale: responsive acceleration while keeping controllability and preventing runaway navigation.\n\n3) Safety clamps\n- `min_region_extent = 1e-15`\n- `max_region_extent = 20.0`\n- `max_center_abs = 100.0`\n- Rationale: permissive exploration bounds with safeguards against numeric instability and meaningless far-field drift.\n\n4) Focus suppression predicate\n- Initial policy: suppress flight when `egui_ctx.wants_keyboard_input()` is true.\n- Rationale: safe default preventing hotkey conflicts during text entry; can narrow later if needed.\n\n5) Scheduler gating policy\n- During active flight: strict completion-based gating (one in-flight render, coalesce pending to newest).\n- During inactive flight: allow immediate resubmission/cancellation for snappy parameter tweaks.\n\n6) World-unit definition\n- Speed unit is fraction-of-view per second (`delta = heading * speed * dt * extent`).\n- Rationale: consistent perceived motion across zoom levels.\n\nThis issue now serves as the authoritative decision ledger for implementation tasks `ejp`, `1f0`, `2wi`, `2wo`, and `oeb`.","created_at":"2026-03-01T14:16:52Z"}]}
{"id":"fractal_explorer-31e","title":"Unit tests for FlightSimulator","description":"# Unit tests for FlightSimulator\n\n## What\nTest the fixed-tick driver's accumulator logic, tick capping, and integration behavior.\n\n## File\nsrc/controllers/interactive/flight/simulator.rs (#[cfg(test)] mod tests)\n\n## Test cases\n\n### Accumulator / tick counting\n1. **Exact tick** → 1/60s elapsed at 60Hz produces exactly 1 tick\n2. **Multiple ticks** → 3/60s elapsed produces 3 ticks\n3. **Fractional tick** → 0.5/60s elapsed produces 0 ticks, accumulator retains remainder\n4. **Accumulator rollover** → partial tick from previous frame + partial from current = 1 full tick\n5. **Zero elapsed** → 0 ticks, no state change\n\n### Tick cap (spiral of death)\n6. **Large elapsed capped** → 1 second at 60Hz would be 60 ticks, but capped at max_ticks_per_redraw (e.g., 10)\n7. **Excess time dropped** → after cap, accumulator doesn't carry the excess\n\n### Integration with motion step\n8. **Controls applied per tick** → controls_fn called once per tick\n9. **Fractal update called per tick** → update_fractal called once per tick\n10. **Paused produces no state change** → advance() with paused motion returns state_changed=false\n\n### State management\n11. **reset_motion() clears state** → motion returns to defaults\n12. **is_active() true when moving** → speed != 0 and not paused\n13. **is_active() false when paused** → even with speed != 0\n14. **is_active() false when stationary** → speed == 0 even when not paused\n\n## Acceptance criteria\n- All tests pass\n- Tests don't depend on wall-clock time (use explicit Duration values)\n- Tests verify tick counts and accumulator behavior precisely","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T13:48:59.430022296Z","created_by":"ren","updated_at":"2026-03-01T16:31:26.801358270Z","closed_at":"2026-03-01T16:31:26.791664590Z","close_reason":"Added FlightSimulator tests for tick accounting, cap/drop policy, per-tick callbacks, reset, status, and activity semantics","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-31e","depends_on_id":"fractal_explorer-2wo","type":"blocks","created_at":"2026-03-01T14:01:31.185173053Z","created_by":"ren"}]}
{"id":"fractal_explorer-323","title":"Implement FlightStatus and FlightWarning","description":"# Implement FlightStatus and FlightWarning\n\n## What\nDefine status/feedback types that the flight system exposes for UI display and debugging.\n\n## File\nsrc/core/flight/status.rs\n\n## Type definitions\n\\`\\`\\`rust\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum FlightWarning {\n    SpeedClamped,\n    CenterClamped,\n    ExtentClamped,\n    NonFiniteReset,\n}\n\n#[derive(Debug, Clone, PartialEq)]\npub struct FlightStatus {\n    pub paused: bool,\n    pub speed: f64,\n    pub heading: [f64; 2],\n    pub last_warning: Option<FlightWarning>,\n}\n\\`\\`\\`\n\n## Design rationale\n\n### Why a separate status type instead of exposing MotionState directly?\nFlightStatus is a read-only view suitable for display. MotionState is mutable internal state. Separating them:\n1. Prevents UI code from accidentally mutating motion state\n2. Allows the status to include derived/aggregated info (like warnings from the fractal updater) without polluting the motion model\n3. Decouples the UI contract from internal representation\n\n### FlightWarning semantics\nWarnings are non-fatal — they indicate a safety clamp activated. The UI should display them briefly (or in a status line) but not block the user. Each tick can produce at most one warning (the most recent one). This keeps the UI simple: show-or-don't.\n\n### Why Option<FlightWarning> instead of Vec?\nSimplicity. Multiple simultaneous clamps are unlikely in practice (e.g., speed clamp and center clamp hitting at the same frame). If it happens, we show the last one. Adding Vec later is backward-compatible if needed.\n\n## Acceptance criteria\n- FlightWarning enum with all four variants\n- FlightStatus struct with paused, speed, heading, last_warning\n- FlightWarning: Debug, Clone, Copy, PartialEq, Eq\n- FlightStatus: Debug, Clone, PartialEq\n- Default FlightStatus matches MotionState defaults (paused=false, speed=0, heading=[0,-1], no warning)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T13:46:37.377895099Z","created_by":"ren","updated_at":"2026-03-01T16:18:54.058919729Z","closed_at":"2026-03-01T16:18:54.047615524Z","close_reason":"Implemented FlightStatus and FlightWarning with default/status tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-323","depends_on_id":"fractal_explorer-24b","type":"blocks","created_at":"2026-03-01T13:58:56.187108556Z","created_by":"ren"}]}
{"id":"fractal_explorer-33i","title":"Implement Mandelbrot flight updater","description":"# Implement Mandelbrot flight updater\n\n## What\nFractal-specific view update function for Mandelbrot that translates the ComplexRect region based on motion state.\n\n## File\nsrc/core/fractals/mandelbrot/flight.rs (new file)\n\n## Also modify\n- src/core/fractals/mandelbrot/mod.rs — add \\`pub mod flight;\\`\n\n## Function signature\n\\`\\`\\`rust\npub fn step_flight(\n    config: &mut MandelbrotConfig,\n    motion: &MotionState,\n    dt: f64,\n    limits: &FlightLimits,\n) -> FlightUpdateReport\n\\`\\`\\`\n\n## Algorithm\n\n### 1. Skip if paused\nIf motion.paused or motion.speed_world_per_sec == 0.0, return early (no-op).\n\n### 2. Translate region (view-relative world units)\n\\`\\`\\`\ndelta_real = motion.heading[0] * motion.speed_world_per_sec * dt * config.region.width()\ndelta_imag = motion.heading[1] * motion.speed_world_per_sec * dt * config.region.height()\n\\`\\`\\`\nAdd delta to both corners of the ComplexRect to translate it.\n\n### 3. Center clamp\n- Compute center of region: ((tl.real + br.real)/2, (tl.imag + br.imag)/2)\n- Clamp each component to [-max_center_abs, +max_center_abs]\n- Rebuild region around clamped center with same width/height\n\n### 4. Extent clamp\n- Ensure width and height are within [min_region_extent, max_region_extent]\n- If either is out of bounds, scale both by a single factor to preserve aspect ratio\n- Rebuild region around current center\n\n### 5. Non-finite guard\n- If any ComplexRect values are NaN or infinity, reset to default_region() and emit NonFiniteReset warning\n\n### FlightUpdateReport\n- clamped: bool (any clamp triggered)\n- warning: Option<FlightWarning>\n\n## Why view-relative world units?\nSpeed is measured in \"fractions of view width per second\". This means that at any zoom level, holding K for the same duration moves the view by the same *apparent* distance on screen. Without this, speed would feel very different at high zoom vs low zoom — at deep zoom, even tiny absolute movements would whip the view across the fractal.\n\n## Why separate from Julia even though identical?\nThe implementation plan explicitly requires separate implementations for future divergence safety. Julia might later support flight that also animates the c parameter, or uses different clamp bounds, or has algorithm-specific inertia. Separating now avoids a refactor later.\n\n## Why clamp after translation, not during?\nSimpler logic and clearer separation of concerns. Translate first, then enforce invariants. This pattern is common in game physics (integrate, then resolve constraints).\n\n## Acceptance criteria\n- step_flight() translates region correctly\n- Center clamp works with preserved dimensions\n- Extent clamp preserves aspect ratio\n- Non-finite guard resets to default\n- FlightUpdateReport correctly reports clamps\n- No changes to MandelbrotConfig struct itself (flight mutates config.region from outside)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T13:47:54.760228894Z","created_by":"ren","updated_at":"2026-03-01T16:25:09.094437667Z","closed_at":"2026-03-01T16:25:09.084216778Z","close_reason":"Implemented Mandelbrot step_flight with translation, center/extent clamps, non-finite reset, and tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-33i","depends_on_id":"fractal_explorer-1ya","type":"blocks","created_at":"2026-03-01T14:01:30.566398018Z","created_by":"ren"}]}
{"id":"fractal_explorer-364","title":"Manual acceptance testing of flight system","description":"# Manual acceptance testing of flight system\n\n## What\nRun the GUI and verify all behavioral scenarios from the spec against actual behavior.\n\n## Scenarios to verify (from specs/motion.md)\n\n### Core motion\n1. **W + K** → view moves upward with increasing speed\n2. **J while moving forward** → speed decreases; passing zero reverses direction\n3. **W+D** → diagonal movement at ~45 degrees\n4. **Release WASD** → heading retained, motion continues at current speed\n5. **P** → motion freezes immediately; P again resumes from same state\n\n### Fractal switching\n6. **Switch Mandelbrot <-> Julia** → motion state resets (speed=0, heading=default)\n\n### Determinism\n7. **Motion is smooth** → no visible jitter or jumps under normal frame rates\n\n### Safety\n8. **Fly far from fractal** → view clamps at center limit, warning displayed, app stays responsive\n9. **Hold K for extended time** → speed clamps at max, warning displayed\n\n### Render submission\n10. **Frames complete during flight** → view updates visibly while moving (not frozen)\n11. **Non-flight UI changes** → sliders/colour map changes still feel instant\n\n### Focus suppression\n12. **Click into egui text input** → flight keys do nothing while typing\n13. **Click out of text input** → flight keys work again\n\n## Testing method\nBuild and run the GUI:\n\\`\\`\\`bash\ncargo run --release --features gui --bin gui\n\\`\\`\\`\n\nOptionally capture screenshots with grim for documentation:\n\\`\\`\\`bash\ngrim /tmp/flight_test_<scenario>.png\n\\`\\`\\`\n\n## Acceptance criteria\n- All 13 scenarios verified and working\n- No crashes or hangs during any scenario\n- Performance is acceptable (smooth motion at reasonable frame rates)\n- Warnings display correctly in debug panel\n- Document any tuning adjustments made (acceleration, speed limits, etc.)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T13:51:29.167249841Z","created_by":"ren","updated_at":"2026-03-01T17:19:01.171432872Z","closed_at":"2026-03-01T17:19:01.155261515Z","close_reason":"Manual acceptance scenarios validated in GUI session: motion controls, pause/resume, heading retention, fractal-switch reset, clamp feedback, focus suppression, and visible frame completion during active flight after starvation/race fixes","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-364","depends_on_id":"fractal_explorer-10c","type":"blocks","created_at":"2026-03-01T14:15:26.852200297Z","created_by":"ren"},{"issue_id":"fractal_explorer-364","depends_on_id":"fractal_explorer-1tg","type":"blocks","created_at":"2026-03-01T14:01:32.564242869Z","created_by":"ren"},{"issue_id":"fractal_explorer-364","depends_on_id":"fractal_explorer-28c","type":"blocks","created_at":"2026-03-01T14:15:25.542442448Z","created_by":"ren"},{"issue_id":"fractal_explorer-364","depends_on_id":"fractal_explorer-2bx","type":"blocks","created_at":"2026-03-01T14:15:27.330957982Z","created_by":"ren"},{"issue_id":"fractal_explorer-364","depends_on_id":"fractal_explorer-2ly","type":"blocks","created_at":"2026-03-01T14:15:25.946035750Z","created_by":"ren"},{"issue_id":"fractal_explorer-364","depends_on_id":"fractal_explorer-30g","type":"blocks","created_at":"2026-03-01T14:15:28.727658923Z","created_by":"ren"},{"issue_id":"fractal_explorer-364","depends_on_id":"fractal_explorer-31e","type":"blocks","created_at":"2026-03-01T14:15:26.412005130Z","created_by":"ren"},{"issue_id":"fractal_explorer-364","depends_on_id":"fractal_explorer-3qw","type":"blocks","created_at":"2026-03-01T14:15:28.257491929Z","created_by":"ren"},{"issue_id":"fractal_explorer-364","depends_on_id":"fractal_explorer-db6","type":"blocks","created_at":"2026-03-01T14:15:27.766758586Z","created_by":"ren"},{"issue_id":"fractal_explorer-364","depends_on_id":"fractal_explorer-oeb","type":"blocks","created_at":"2026-03-01T14:01:32.429869832Z","created_by":"ren"}],"comments":[{"id":14,"issue_id":"fractal_explorer-364","author":"John King","text":"Quality-gate update: this issue is intentionally blocked on automated test suites (28c, 2ly, 31e, 10c, 2bx, db6, 3qw) plus decision-lock issue 30g. Manual acceptance should execute only after those pass so scenario failures are signal, not noise from known unit-level regressions.","created_at":"2026-03-01T14:18:02Z"}]}
{"id":"fractal_explorer-3ck","title":"[Milestone] Simulation and render scheduling infrastructure","description":"# Milestone: Simulation and render scheduling infrastructure\n\n## Purpose\nProvide deterministic fixed-tick simulation and render submission gating so motion remains responsive without starving frame completion.\n\n## Scope\n- `FlightSimulator` fixed-tick accumulator driver.\n- `InteractiveController` completion signal (`last_completed_generation`).\n- `RenderScheduler` coalescing and gating policy.\n- Unit tests for simulator, scheduler, and completion tracking behavior.\n\n## Why this milestone matters\nThe renderer's latest-generation cancellation model can starve presentation if flight submits too often. This milestone introduces completion-aware scheduling to preserve both responsiveness and visible progress.\n\n## Definition of done\n- Simulator runs deterministic ticks with cap guard.\n- Controller exposes monotonic completion generation signal.\n- Scheduler coalesces during active flight and submits immediately when flight is inactive.\n- Automated tests cover all critical state transitions.\n\n## Acceptance Criteria\n- Child tasks for simulator, scheduler, controller tracking, and their tests are completed.\n- No starvation scenario remains in expected flight workloads.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-03-01T14:11:15.040677894Z","created_by":"ren","updated_at":"2026-03-01T16:31:36.392190700Z","closed_at":"2026-03-01T16:31:36.379559395Z","close_reason":"Completed fixed-tick simulator, completion tracking, scheduler gating, and full unit test coverage","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-3ck","depends_on_id":"fractal_explorer-10c","type":"blocks","created_at":"2026-03-01T14:14:33.374617039Z","created_by":"ren"},{"issue_id":"fractal_explorer-3ck","depends_on_id":"fractal_explorer-1xl","type":"blocks","created_at":"2026-03-01T14:15:07.338019080Z","created_by":"ren"},{"issue_id":"fractal_explorer-3ck","depends_on_id":"fractal_explorer-2wi","type":"blocks","created_at":"2026-03-01T14:14:33.065316838Z","created_by":"ren"},{"issue_id":"fractal_explorer-3ck","depends_on_id":"fractal_explorer-2wo","type":"blocks","created_at":"2026-03-01T14:14:33.700975354Z","created_by":"ren"},{"issue_id":"fractal_explorer-3ck","depends_on_id":"fractal_explorer-31e","type":"blocks","created_at":"2026-03-01T14:14:34.024158421Z","created_by":"ren"},{"issue_id":"fractal_explorer-3ck","depends_on_id":"fractal_explorer-3p2","type":"blocks","created_at":"2026-03-01T14:14:32.754363502Z","created_by":"ren"},{"issue_id":"fractal_explorer-3ck","depends_on_id":"fractal_explorer-3qw","type":"blocks","created_at":"2026-03-01T14:14:34.359240519Z","created_by":"ren"}],"comments":[{"id":6,"issue_id":"fractal_explorer-3ck","author":"John King","text":"Two parallel branches: (A) simulation driver  -> ; (B) completion signal  -> scheduler  -> scheduler/controller tests (, ). Branches reunite in GUI integration milestone.","created_at":"2026-03-01T14:17:13Z"},{"id":11,"issue_id":"fractal_explorer-3ck","author":"John King","text":"Superseding note (corrected formatting): parallel branches are\n(A) simulator path: 2wo -> 31e,\n(B) scheduler path: 3p2 -> 2wi -> (10c, 3qw).\nBoth must be complete before GUI integration depends on this milestone.","created_at":"2026-03-01T14:17:25Z"},{"id":21,"issue_id":"fractal_explorer-3ck","author":"John King","text":"Note: if an earlier comment in this thread shows missing issue IDs, treat it as a formatting artifact; use the most recent 'Superseding note' comment as authoritative.","created_at":"2026-03-01T14:19:42Z"}]}
{"id":"fractal_explorer-3hv","title":"[Epic] Real-Time Fractal Flight System","description":"# Epic: Real-Time Fractal Flight System\n\nKeyboard-driven real-time flight through fractal space with deterministic motion, algorithm-specific updates, soft safety limits, and render-starvation prevention.\n\n## Why this epic exists\nThe explorer currently supports static parameter edits but not continuous navigation. Flight turns the product into an interactive exploration experience while preserving architectural separation (`core` domain logic, `controllers` orchestration, GUI-only adapters).\n\n## Behavioral contract (source of truth)\n- Inputs: `W/A/S/D` direction, `K/J` accelerate/decelerate, `P` pause toggle edge.\n- Motion: signed speed + heading vector; diagonal normalization; heading retention when WASD released.\n- Pause: simulation freeze/resume without state loss.\n- Timing: fixed-tick deterministic simulation independent of render rate.\n- Safety: soft clamps for speed, region extent, and center bounds with non-fatal warnings.\n- Focus suppression: flight keys ignored while text-editing widgets are focused.\n- Fractal switch: reset motion state to defaults.\n- Rendering: latest-state intent preserved while submission gating prevents starvation.\n\n## Architectural commitments\n1. Motion state is flight-owned, not embedded in fractal configs.\n2. Mandelbrot and Julia flight updates are implemented separately (future divergence safety).\n3. Core modules remain GUI-free.\n4. Render scheduling uses completion-aware gating during active flight.\n\n## Execution structure (milestone hierarchy)\n- `fractal_explorer-1xl` — Core flight domain foundation.\n- `fractal_explorer-15a` — Fractal-specific flight updaters.\n- `fractal_explorer-3ck` — Simulation and render scheduling infrastructure.\n- `fractal_explorer-3nv` — GUI integration and input handling.\n- `fractal_explorer-1kk` — Verification, tuning, and acceptance.\n\n## Planning references\n- `specs/motion.md`\n- `plans/motion_architecture.md`\n- `plans/motion_implementation.md`\n\n## Acceptance Criteria\n- All milestone child issues are completed with dependencies satisfied.\n- Automated unit tests comprehensively cover motion, updaters, simulator, scheduler, controller completion tracking, input adapter, and core primitives.\n- Manual acceptance scenarios validate controls, clamping, switching, focus suppression, and non-starving rendering behavior.\n- The beads graph and issue comments are self-contained enough to execute without reopening the planning markdown files.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-03-01T13:45:38.725708081Z","created_by":"ren","updated_at":"2026-03-01T17:19:02.775179898Z","closed_at":"2026-03-01T17:19:02.761245184Z","close_reason":"Epic complete: core motion, fractal updaters, simulation/scheduler infrastructure, GUI integration, and acceptance verification all delivered","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-3hv","depends_on_id":"fractal_explorer-15a","type":"related","created_at":"2026-03-01T14:16:35.868119185Z","created_by":"ren"},{"issue_id":"fractal_explorer-3hv","depends_on_id":"fractal_explorer-1kk","type":"related","created_at":"2026-03-01T14:16:37.164196225Z","created_by":"ren"},{"issue_id":"fractal_explorer-3hv","depends_on_id":"fractal_explorer-1xl","type":"related","created_at":"2026-03-01T14:16:31.352920166Z","created_by":"ren"},{"issue_id":"fractal_explorer-3hv","depends_on_id":"fractal_explorer-3ck","type":"related","created_at":"2026-03-01T14:16:36.293144200Z","created_by":"ren"},{"issue_id":"fractal_explorer-3hv","depends_on_id":"fractal_explorer-3nv","type":"related","created_at":"2026-03-01T14:16:36.721679873Z","created_by":"ren"}],"comments":[{"id":1,"issue_id":"fractal_explorer-3hv","author":"John King","text":"## Child Tasks (Dependency Order)\n\n### Milestone 1: Core Flight Primitives\n- **24b**: Create core::flight module skeleton (ROOT)\n- **1sm**: FlightControlsSnapshot (depends on 24b)\n- **ejp**: FlightLimits (depends on 24b)\n- **323**: FlightStatus/FlightWarning (depends on 24b)\n- **1ya**: MotionState + step_motion() (depends on 1sm, ejp, 323)\n- **28c**: Unit tests for step_motion() (depends on 1ya)\n\n### Milestone 2: Per-Fractal Flight Updaters\n- **33i**: Mandelbrot flight updater (depends on 1ya)\n- **9bc**: Julia flight updater (depends on 1ya)\n- **2ly**: Unit tests for fractal updaters (depends on 33i, 9bc)\n\n### Milestone 3: Simulation Driver\n- **2wo**: FlightSimulator (depends on 1ya, 1sm)\n- **31e**: Unit tests for FlightSimulator (depends on 2wo)\n\n### Milestone 4: Render Submission (parallel with M1-M3)\n- **3p2**: last_completed_generation in InteractiveController (no deps)\n- **2wi**: RenderScheduler (depends on 3p2)\n- **10c**: Unit tests for RenderScheduler (depends on 2wi)\n\n### Milestone 5: GUI Layer\n- **1f0**: FlightInputState adapter (depends on 1sm)\n- **oeb**: GuiApp integration (depends on 2wo, 2wi, 1f0, 33i, 9bc)\n- **1tg**: Flight status UI (depends on oeb)\n\n### Milestone 6: Validation\n- **364**: Manual acceptance testing (depends on oeb, 1tg)\n\n## Parallelism: M4 is independent and can run alongside M1-M3.","created_at":"2026-03-01T14:02:05Z"},{"id":3,"issue_id":"fractal_explorer-3hv","author":"John King","text":"Revised execution graph and traceability map (supersedes the older milestone comment):\n\nMilestone features:\n- `1xl` Core flight domain foundation\n- `15a` Fractal-specific flight updaters\n- `3ck` Simulation and render scheduling infrastructure\n- `3nv` GUI integration and input handling\n- `1kk` Verification, tuning, and acceptance\n\nNew granular tasks added:\n- `30g` Lock and document flight tuning decisions\n- `2bx` Unit tests for core flight primitives\n- `db6` Unit tests for FlightInputState\n- `3qw` Unit tests for last_completed_generation tracking\n\nSpec/plan coverage matrix:\n- Input semantics + edge handling -> `1sm`, `1f0`, `db6`\n- Motion state + deterministic step order -> `1ya`, `28c`\n- Limits/clamps + warning surface -> `ejp`, `323`, `2bx`\n- Mandelbrot/Julia separate updater contracts -> `33i`, `9bc`, `2ly`\n- Fixed tick + accumulator/cap -> `2wo`, `31e`\n- Completion signal + submission gate/coalescing -> `3p2`, `3qw`, `2wi`, `10c`\n- GuiApp orchestration + redraw + fractal switch reset -> `oeb`\n- Visible status panel -> `1tg`\n- End-to-end manual acceptance scenarios -> `364`\n\nQuality-gate policy:\n- Manual acceptance `364` now depends on all major automated test tasks and decision-lock issue `30g`.\n- This enforces “plan space first, then deterministic verification, then manual validation.”","created_at":"2026-03-01T14:17:00Z"}]}
{"id":"fractal_explorer-3nv","title":"[Milestone] GUI integration and input handling","description":"# Milestone: GUI integration and input handling\n\n## Purpose\nWire flight into `GuiApp` end-to-end: key tracking, per-tick control snapshots, simulation advancement, scheduler interaction, and user-visible status.\n\n## Scope\n- `FlightInputState` adapter for `winit` key events.\n- `GuiApp` integration ordering (UI updates, fractal switch reset, simulation, scheduling, rendering).\n- Continuous redraw policy during active flight.\n- Debug panel flight status display.\n- Input-adapter unit tests.\n\n## Definition of done\n- Flight controls (WASD/JK/P) work in GUI with focus suppression.\n- Fractal switch resets motion/scheduler state.\n- Scheduler-backed submission path replaces ad-hoc submit flow.\n- UI status reflects paused/speed/heading/warnings.\n\n## Acceptance Criteria\n- Child implementation and test tasks are completed.\n- GUI behavior matches all flight interaction semantics from the spec.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-03-01T14:11:15.188575204Z","created_by":"ren","updated_at":"2026-03-01T16:36:11.921577626Z","closed_at":"2026-03-01T16:36:11.910155864Z","close_reason":"Completed GUI key adapter, event-loop integration, continuous redraw behavior, and flight status UI","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-3nv","depends_on_id":"fractal_explorer-15a","type":"blocks","created_at":"2026-03-01T14:15:08.060721550Z","created_by":"ren"},{"issue_id":"fractal_explorer-3nv","depends_on_id":"fractal_explorer-1f0","type":"blocks","created_at":"2026-03-01T14:14:34.713707330Z","created_by":"ren"},{"issue_id":"fractal_explorer-3nv","depends_on_id":"fractal_explorer-1tg","type":"blocks","created_at":"2026-03-01T14:14:35.390458321Z","created_by":"ren"},{"issue_id":"fractal_explorer-3nv","depends_on_id":"fractal_explorer-1xl","type":"blocks","created_at":"2026-03-01T14:15:07.700031207Z","created_by":"ren"},{"issue_id":"fractal_explorer-3nv","depends_on_id":"fractal_explorer-3ck","type":"blocks","created_at":"2026-03-01T14:15:08.434064406Z","created_by":"ren"},{"issue_id":"fractal_explorer-3nv","depends_on_id":"fractal_explorer-db6","type":"blocks","created_at":"2026-03-01T14:14:35.737738543Z","created_by":"ren"},{"issue_id":"fractal_explorer-3nv","depends_on_id":"fractal_explorer-oeb","type":"blocks","created_at":"2026-03-01T14:14:35.051136128Z","created_by":"ren"}],"comments":[{"id":7,"issue_id":"fractal_explorer-3nv","author":"John King","text":"GUI milestone sequencing: input adapter  with tests  first, then full GuiApp integration , then status display . Integration must preserve existing non-flight UI responsiveness while enabling continuous redraw during active flight.","created_at":"2026-03-01T14:17:13Z"},{"id":12,"issue_id":"fractal_explorer-3nv","author":"John King","text":"Superseding note (corrected formatting): sequencing is 1f0 + db6 first, then oeb integration, then 1tg status panel.\nGoal is full control semantics plus status visibility without regressing existing UI responsiveness.","created_at":"2026-03-01T14:17:26Z"},{"id":22,"issue_id":"fractal_explorer-3nv","author":"John King","text":"Note: if an earlier comment in this thread shows missing issue IDs, treat it as a formatting artifact; use the most recent 'Superseding note' comment as authoritative.","created_at":"2026-03-01T14:19:43Z"}]}
{"id":"fractal_explorer-3p2","title":"Add last_completed_generation to InteractiveController","description":"# Add last_completed_generation to InteractiveController\n\n## What\nExtend the InteractiveController's SharedState with an atomic counter that tracks the most recently completed render generation. This is the reliable completion signal that the RenderScheduler needs to avoid starving the renderer during flight.\n\n## Files to modify\n- src/controllers/interactive/controller.rs\n\n## Changes\n\n### SharedState addition\n\\`\\`\\`rust\nstruct SharedState {\n    // ... existing fields ...\n    last_completed_generation: AtomicU64,  // NEW\n}\n\\`\\`\\`\n\n### Update on completion\nIn the worker loop, when about to call presenter_port.present() for a Frame or Error:\n\\`\\`\\`rust\nself.shared.last_completed_generation.store(job_generation, Ordering::Release);\n\\`\\`\\`\n\n### Public accessor\n\\`\\`\\`rust\nimpl InteractiveController {\n    pub fn last_completed_generation(&self) -> u64 {\n        self.shared.last_completed_generation.load(Ordering::Acquire)\n    }\n}\n\\`\\`\\`\n\n## Why this is needed\n\n### The render starvation problem\nThe current rendering model uses generation counters: each submit_request() bumps generation, and the worker cancels in-progress work when generation changes. The GUI presenter only displays frames matching the latest generation.\n\nDuring flight, the simulation generates new desired states at 60Hz. If each state is submitted immediately, it cancels the previous render before it can complete, resulting in *no frames being displayed* during motion. The view would appear frozen while the user is flying.\n\n### Why atomic, not channel/callback?\n- The worker thread already has a clean single-consumer loop. Adding a channel would complicate the threading model.\n- An atomic counter is the simplest reliable signal: the scheduler reads it, the worker writes it, no synchronization beyond the atomic itself.\n- Acquire/Release ordering is sufficient: the scheduler only needs to see that a generation completed, not the frame data (which goes through the presenter port).\n\n### Why update before present(), not after?\nTechnically either works, but updating *when* the worker is about to emit the result (just before present()) ensures the scheduler sees completion as early as possible. This slightly reduces latency between a render finishing and the next request being submitted.\n\n### Monotonicity\nGenerations are monotonically increasing (assigned from an AtomicU64 counter). The worker processes them in arrival order, and stale results are discarded. So last_completed_generation is naturally monotonic — it never decreases.\n\n## Acceptance criteria\n- SharedState has last_completed_generation: AtomicU64\n- Worker updates it before calling present() for Frame or Error\n- Public method last_completed_generation() returns current value\n- Existing tests still pass (this is additive, no behavioral change)\n- New test: verify last_completed_generation updates after a render completes","status":"closed","priority":1,"issue_type":"task","created_at":"2026-03-01T13:49:20.469382685Z","created_by":"ren","updated_at":"2026-03-01T16:31:05.247271127Z","closed_at":"2026-03-01T16:31:05.236300759Z","close_reason":"Added last_completed_generation tracking in controller worker and accessor API","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":15,"issue_id":"fractal_explorer-3p2","author":"John King","text":"Test scope for this issue is split out explicitly into 3qw (unit tests for frame/error completion updates and monotonicity). Keep implementation focused here; close only with 3qw linked and passing.","created_at":"2026-03-01T14:18:07Z"}]}
{"id":"fractal_explorer-3qw","title":"Unit tests for last_completed_generation tracking","description":"# Unit tests for last_completed_generation tracking\n\n## What\nAdd tests around `InteractiveController` completion tracking to verify correctness and monotonicity of the render completion signal used by `RenderScheduler`.\n\n## File\n- `src/controllers/interactive/controller.rs`\n\n## Test coverage\n1. Counter initializes to `0` (or the documented initial baseline).\n2. Completing a frame updates `last_completed_generation` to that generation.\n3. Completing an error also updates the counter.\n4. Value is monotonic across mixed frame/error completions.\n5. Accessor reflects worker-thread updates correctly.\n\n## Why this matters\n`RenderScheduler` correctness depends on this signal. If it regresses, starvation mitigation fails silently.\n\n## Acceptance criteria\n- Tests are deterministic and avoid timing flakiness.\n- Both frame and error completion paths are covered.\n- Monotonicity is asserted explicitly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T14:11:15.871364649Z","created_by":"ren","updated_at":"2026-03-01T16:31:25.386959014Z","closed_at":"2026-03-01T16:31:25.373721742Z","close_reason":"Added deterministic tests for completion counter initialization, frame/error updates, and monotonic behavior","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-3qw","depends_on_id":"fractal_explorer-3p2","type":"blocks","created_at":"2026-03-01T14:15:25.103966831Z","created_by":"ren"}]}
{"id":"fractal_explorer-9bc","title":"Implement Julia flight updater","description":"# Implement Julia flight updater\n\n## What\nFractal-specific view update function for Julia. Currently identical logic to Mandelbrot, but implemented separately for future divergence.\n\n## File\nsrc/core/fractals/julia/flight.rs (new file)\n\n## Also modify\n- src/core/fractals/julia/mod.rs — add \\`pub mod flight;\\`\n\n## Function signature\n\\`\\`\\`rust\npub fn step_flight(\n    config: &mut JuliaConfig,\n    motion: &MotionState,\n    dt: f64,\n    limits: &FlightLimits,\n) -> FlightUpdateReport\n\\`\\`\\`\n\n## Algorithm\nIdentical to Mandelbrot flight updater (see that task for full details):\n1. Skip if paused or speed == 0\n2. Translate region by view-relative delta\n3. Center clamp\n4. Extent clamp (aspect-ratio preserving)\n5. Non-finite guard\n\n## Why not share code with Mandelbrot via a generic function?\nTempting, but the plan explicitly calls for separate implementations. The reasoning:\n- Julia may later support c-parameter animation during flight (moving through Julia set \"slices\")\n- Different fractals may have different natural bounds and default regions\n- The cost of duplication is low (the function is ~30 lines)\n- Premature abstraction would create coupling that hinders future divergence\n\nIf substantial shared logic emerges across 3+ fractals, we can extract a helper then. Two is not yet a pattern worth abstracting.\n\n## Acceptance criteria\n- step_flight() for JuliaConfig works identically to Mandelbrot version\n- Uses Julia's own default_region() for non-finite reset\n- Same FlightUpdateReport type\n- Unit tests mirror Mandelbrot tests","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T13:48:05.741593497Z","created_by":"ren","updated_at":"2026-03-01T16:25:09.675939788Z","closed_at":"2026-03-01T16:25:09.665643598Z","close_reason":"Implemented Julia step_flight separately with matching behavior and tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-9bc","depends_on_id":"fractal_explorer-1ya","type":"blocks","created_at":"2026-03-01T14:01:30.659066242Z","created_by":"ren"}]}
{"id":"fractal_explorer-db6","title":"Unit tests for FlightInputState","description":"# Unit tests for FlightInputState\n\n## What\nAdd focused tests for the GUI key adapter so edge/held semantics are correct before full GUI integration.\n\n## File\n- `src/input/gui/app/flight_input.rs` (`#[cfg(test)]`)\n\n## Test coverage\n1. Press/release updates held flags for W/A/S/D/J/K.\n2. `P` key-down sets one-shot pause edge; repeat presses before snapshot do not multiply edges.\n3. `snapshot(false)` emits current held state and consumes exactly one pending pause edge.\n4. Multiple snapshots after one press emit edge only once.\n5. `snapshot(true)` focus suppression returns neutral snapshot and suppresses stale edge behavior per chosen policy.\n6. `reset()` clears all held and edge state.\n\n## Why this matters\nThe adapter enforces per-tick control semantics at the GUI boundary. Bugs here can produce subtle pause glitches and inconsistent motion behavior that are hard to debug later.\n\n## Acceptance criteria\n- Tests cover both normal and focus-suppressed flows.\n- One-shot edge semantics are explicitly validated.\n- No dependency on live GUI/event-loop runtime.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T14:11:15.689810106Z","created_by":"ren","updated_at":"2026-03-01T16:33:09.526652017Z","closed_at":"2026-03-01T16:33:09.514536272Z","close_reason":"Added focused FlightInputState tests for held keys, one-shot pause edge, focus suppression, and reset","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-db6","depends_on_id":"fractal_explorer-1f0","type":"blocks","created_at":"2026-03-01T14:15:24.643407705Z","created_by":"ren"}]}
{"id":"fractal_explorer-ejp","title":"Implement FlightLimits and defaults","description":"# Implement FlightLimits and defaults\n\n## What\nDefine the tuning and clamp constants struct with sensible defaults.\n\n## File\nsrc/core/flight/limits.rs\n\n## Type definition\n\\`\\`\\`rust\n#[derive(Debug, Clone, Copy, PartialEq)]\npub struct FlightLimits {\n    pub tick_hz: u32,\n    pub base_accel_world_per_sec2: f64,\n    pub max_speed_abs_world_per_sec: f64,\n    pub min_region_extent: f64,\n    pub max_region_extent: f64,\n    pub max_center_abs: f64,\n    pub max_ticks_per_redraw: u32,\n}\n\\`\\`\\`\n\n## Why these fields?\n- **tick_hz**: Fixed simulation rate. 60 Hz gives smooth motion without excessive CPU. The fixed-tick model ensures determinism: same inputs always produce same outputs regardless of frame rate.\n- **base_accel_world_per_sec2**: How fast speed changes when J/K is held. \"World units\" here means fractions-of-current-view-per-second, so acceleration feels consistent across zoom levels.\n- **max_speed_abs_world_per_sec**: Prevents runaway speed that would make the view shoot past interesting regions instantly.\n- **min/max_region_extent**: Scale bounds. Even though flight doesn't change zoom yet, these clamps prevent invalid numeric states if future features add zoom-during-flight. Also guards against NaN propagation.\n- **max_center_abs**: Prevents the view from drifting so far from the fractal that only empty space is visible. The Mandelbrot set is bounded within |c| <= 2, and Julia sets are similarly bounded, so a generous limit (e.g., 100.0) catches runaway drift without restricting legitimate exploration.\n- **max_ticks_per_redraw**: Spiral-of-death guard. If a frame takes very long (e.g., during a complex render), the accumulator could build up many ticks. Capping prevents the simulation from running hundreds of ticks in a single frame, which would cause a visible jump and waste CPU.\n\n## Default values (initial tuning)\nThese are starting points — expect adjustment during manual testing:\n- tick_hz: 60\n- base_accel: 0.5 (half a view-width per second per second)\n- max_speed: 5.0 (five view-widths per second — fast but controllable)\n- min_region_extent: 1e-15 (near f64 precision limit)\n- max_region_extent: 20.0 (much larger than default views)\n- max_center_abs: 100.0 (generous for exploration)\n- max_ticks_per_redraw: 10 (allows ~167ms frame time before capping)\n\n## Acceptance criteria\n- Struct defined with all fields\n- Default impl with documented initial values\n- Debug, Clone, Copy, PartialEq derived\n- Helper: dt() -> f64 returning 1.0 / tick_hz as f64\n- No GUI dependencies","status":"closed","priority":2,"issue_type":"task","created_at":"2026-03-01T13:46:23.552590225Z","created_by":"ren","updated_at":"2026-03-01T16:18:53.381811564Z","closed_at":"2026-03-01T16:18:53.370998788Z","close_reason":"Implemented FlightLimits defaults and dt helper with invariants tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-ejp","depends_on_id":"fractal_explorer-24b","type":"blocks","created_at":"2026-03-01T13:59:00.535325532Z","created_by":"ren"},{"issue_id":"fractal_explorer-ejp","depends_on_id":"fractal_explorer-30g","type":"blocks","created_at":"2026-03-01T14:15:21.797250131Z","created_by":"ren"}],"comments":[{"id":16,"issue_id":"fractal_explorer-ejp","author":"John King","text":"Decision source: consume constants/policies from 30g so tuning stays centralized and traceable.","created_at":"2026-03-01T14:18:14Z"}]}
{"id":"fractal_explorer-oeb","title":"Integrate flight into GuiApp event loop","description":"# Integrate flight into GuiApp event loop\n\n## What\nWire FlightInputState, FlightSimulator, and RenderScheduler into GuiApp so that flight actually works end-to-end.\n\n## File to modify\nsrc/input/gui/app/gui_app.rs\n\n## New fields on GuiApp\n\\`\\`\\`rust\nflight_input: FlightInputState,\nflight_sim: FlightSimulator,\nscheduler: RenderScheduler,\nlast_redraw_instant: Instant,\nlast_selected_fractal: FractalKinds,\n\\`\\`\\`\n\n## Integration points\n\n### 1. Key event handling\nIn the event loop, on WindowEvent::KeyboardInput:\n- Always update flight_input.handle_key_event() with the key code and state\n- Do this regardless of whether egui consumed the event (egui consumes events for its own widgets, but we still need to track key releases)\n\n### 2. Redraw path changes\nOn RedrawRequested, the current flow is:\n1. update_ui() — GUI changes\n2. submit_render_request_if_needed() — submit if config changed\n3. render pixels + UI overlay\n\nNew flow:\n1. update_ui() — GUI changes (may change fractal, iterations, colour map, etc.)\n2. **Detect fractal switch**: if ui_state.selected_fractal != last_selected_fractal:\n   - flight_sim.reset_motion()\n   - scheduler.reset()\n   - last_selected_fractal = ui_state.selected_fractal\n3. **Compute elapsed time** since last redraw (using last_redraw_instant)\n4. **Advance flight simulation**:\n   - text_editing = egui_ctx.wants_keyboard_input()\n   - flight_sim.advance(elapsed, || flight_input.snapshot(text_editing), |motion, dt, limits| { dispatch to correct fractal updater based on selected_fractal })\n   - The fractal updater closure mutates ui_state.mandelbrot.region or ui_state.julia.region\n5. **Build desired render request** from ui_state (as today)\n6. **Pass to RenderScheduler**: scheduler.update(desired, flight_sim.is_active(), controller.last_completed_generation(), |req| controller.submit_request(req))\n7. **Record submission** if scheduler submitted\n8. **Set redraw_pending = true** if flight is active or scheduler has pending work\n9. Render pixels + UI overlay\n\n### 3. Continuous redraw during flight\nWhile flight is active (speed != 0 and not paused, or acceleration keys held):\n- Keep redraw_pending = true so the event loop continues repainting\n- This ensures motion continues smoothly even without new UI events\n\nConsider also setting ControlFlow::Poll during active flight and ControlFlow::Wait otherwise, to minimize latency. However, redraw_pending=true may be sufficient since the current loop already requests redraw when pending.\n\n### 4. Replace submit_render_request_if_needed()\nThe RenderScheduler subsumes the current submit_render_request_if_needed() logic. The existing should_submit() + record_submission() flow is replaced by the scheduler's update() method. This is the cleanest integration point — the scheduler decides when to submit, and we just pass it the desired state.\n\n## Why this is the most complex task\nThis task ties together all the other components. It requires understanding:\n- winit event loop semantics\n- egui focus detection\n- The existing submission flow in GuiApp\n- How fractal configs are built from GuiAppState\n- The timing of elapsed-time measurement\n\nGetting the order of operations right is critical. The plan specifies the exact sequence for a reason: UI changes must be applied before flight (so sliders/fractal-switch take effect), and flight must run before building the render request (so the updated region is captured).\n\n## Acceptance criteria\n- Flight controls work: WASD moves the view, JK change speed, P pauses\n- Fractal switch resets motion state\n- No frames are starved during flight (scheduler gates submissions)\n- Non-flight UI changes (sliders, colour maps) still feel snappy\n- Text input in egui widgets doesn't trigger flight\n- Continuous redraw during active flight\n- No regressions in existing functionality","status":"closed","priority":1,"issue_type":"task","created_at":"2026-03-01T13:50:55.329893279Z","created_by":"ren","updated_at":"2026-03-01T16:35:57.135231039Z","closed_at":"2026-03-01T16:35:57.121803650Z","close_reason":"Integrated flight input, simulator, scheduler, fractal reset handling, and redraw driving into GuiApp loop","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"fractal_explorer-oeb","depends_on_id":"fractal_explorer-1f0","type":"blocks","created_at":"2026-03-01T14:01:31.908185350Z","created_by":"ren"},{"issue_id":"fractal_explorer-oeb","depends_on_id":"fractal_explorer-2wi","type":"blocks","created_at":"2026-03-01T14:01:31.779952766Z","created_by":"ren"},{"issue_id":"fractal_explorer-oeb","depends_on_id":"fractal_explorer-2wo","type":"blocks","created_at":"2026-03-01T14:01:31.654643549Z","created_by":"ren"},{"issue_id":"fractal_explorer-oeb","depends_on_id":"fractal_explorer-33i","type":"blocks","created_at":"2026-03-01T14:01:32.036118395Z","created_by":"ren"},{"issue_id":"fractal_explorer-oeb","depends_on_id":"fractal_explorer-9bc","type":"blocks","created_at":"2026-03-01T14:01:32.160748265Z","created_by":"ren"}]}
